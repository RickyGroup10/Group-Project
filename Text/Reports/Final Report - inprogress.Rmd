---
title: "A look at dating app user profile statistics"
author: "Lissa Harrop, Katrina Watkins, Ricky Loo and Max Tan"
date: "October 2022"
classoption: 12pt
  
header-includes:
  - \usepackage{newpxtext,eulerpx}
  - \usepackage{bm,bbm}
  - \usepackage{float}
  - \floatplacement{figure}{H}

output: bookdown::pdf_document2

link-citations: yes
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(300521444, kind="Mersenne-Twister") #Mixture of all our ID numbers
require(ggplot2)
require(ggthemes)
require(extrafont)
require(booktabs)
require(GGally)
require(ggExtra)
require(xtable)
require(moments)
require(ggcorrplot)
require(fitdistrplus)
require(reshape2)
#require(farff)
require(ggpubr)
require(dplyr)
require(caret)
require(stringr)
require(ggord)
require(HDtest)
require(MASS)
require(klaR)
```

# Introduction

This study looks at Dating App User Profiles' stats from the Lovoo dating app. The dataset is available on kaggle (@Lovoov3) and the license to use the dataset is available on creativecommons (@License).

Lovoo, is a European dating platform that allows individuals to chat to each other before a mutuality of attraction, unlike other dating platforms that emphasize this before allowing any two people to get in touch and chat. The Lovoo dataset contains profile information on 3992 females that was obtained during April and May of 2015. The dataset contains 22 numerical and 20 categorical variables. We found that there was no information provided about what some of the variables mean. Several of the variables are unique identifiers such as name, userId and pictureId, among others. There are also many variables that are binary classifiers.

This study focuses on seven variables: age, counts_pictures, counts_profileVisits, counts_kisses, distance, country and isVip. Where **Age** is the users age, **counts_pictures** is the number of pictures on the user's profile, **counts_profileVisits** is the number of clicks on this user (to see his/her full profile) from other user accounts, **counts_kisses** is the number of unique user accounts that "liked" (called "kiss" on the platform) this user account, **distance** is the distance between this user's city/location and the location of the user account that was used to fetch the data of this user, **country** is the user's country, **isVip** is a 0 if the user is not a VIP and is 1 if the user is VIP. It was possible to buy a VIP status with real money. This status came with benefits.

# NEED TO ADD WHAT WE WANT TO ACHIEVE
Based on the data we have available we would like to know the following…..

# Overall Methodology

During our exploratory data analysis it was discovered that there were 46 missing values in the variable distance. These have been replaced by the mean of the distance column (207.23). This ensured that we had a full dataset with a sample size of 3992 for all seven variables.

It was also discovered that our data were not normally distributed (and verified by Shapiro-Wilk normality tests), were heavily skewed and had several outliers that were influencing our results. As a result of this we chose to standardise our numerical variables and remove the outliers. We standardised the data through z-score standardisation and removed the outliers by removing any rows of data that had a value greater than 3 (this is three standard deviations). As a result of this our dataset was reduced to a sample size of 3816 users. 

For the categorical variable country we saw that 28 of the 32 countries have 20 or less users with 13 of these having only 1 user. As a result we decided to group all countries that had 20 users or less into one new category called “other”. This gave us 5 countries – Italy, France, Germany, Switzerland and Other.

# NEED TO WRITE WHY WE CHOSE EACH OF THESE
Why we chose to do CA, PCA and LDA

# EDA

The exploratory data analysis (EDA) started with a univariate analysis of our seven variables. 
Looking at the variable age we discovered that the median age of a user on the Lovoo dating app is 22 years old, with the youngest users being 18 years old and the oldest users being 28 years old. With approximately 75% of users being aged 20 to 24 years.

The median number of pictures a user has on their profile is 4, however there are some users that have no pictures and others that have up to 30 pictures. The bulk of users tend to have less than 10 profile pictures on their account, with a small number of users having between 11 and 30 profile pictures.

The median number of clicks on a user’s profile to see his/her full profile (from another user's account) is 1222, with some users having no visits to their profile and some having up to 164425 visits. We discovered that the mean number of profile visits is roughly at the 75th percentile. 25% of users tend to have extremely large numbers of profile visits.

The median number of unique user accounts that “liked” a user’s account is 44, with the number of likes ranging from 0 to 9288. Again, we saw that the median was close to the 75th percentile and there were several users with a large number of likes.

The median distance between this user's city/location and the location of the user account that was used to fetch the data is 173, with the range being from 0 to 6918. No units of measurement are indicated in the dataset.

The users are from 32 different countries ranging from 1 user to 1657 users with Italy, France, Germany and Switzerland being the countries with the most users. As mentioned previously 28 of the 32 countries have 20 or less users with 13 of these only having 1 user. As a result we decided to group all countries that had 20 users or less into one new category called “other”. This gave us 5 countries – Italy with 138 users, France with 646 users, Germany with 1468 users, Switzerland with 1657 users and Other with 83 users.

Of the 3992 users 91 of them have purchased VIP leaving 3901 users that have not purchased VIP.

From these results we can see that our data are not normally distributed, heavily skewed and had several outliers that were influencing our results.

# <<Example plot>>

Our EDA then looked at bivariate and multivariate analysis in varying combinations of the seven variables. 

We found that there is a strong positive correlation (0.89) between the number of profiles visits and the number of likes that a user receives. There is also a positive correlation (0.42) between the number of pictures a user has and the number of profile visits they receive and a positive correlation (0.37) between the number of pictures a user has and the number of likes they receive. There is a slight positive correlation (0.13) between the age of the user and the distance between this user’s city/location and the location of the user account that was used to fetch the data of the user. There appears to be no correlation between age and likes, profile visits and pictures, nor distance and likes, profile visits and pictures. This can be seen in <<ref heatmap>>.

# <<Heatmap plot>>

In the univariate analysis we saw that 3901 users are not Vip’s while only 91 are Vip’s. When comparing VIP status with country we saw that Switzerland has the largest number of users with VIP status.

When looking at the number of users by age and country we saw that the number of users by age tends to increase in Germany and peak at 22 years old before decreasing. Whereas in France and Switzerland they tend to start with a larger number of users at a younger age and decrease as age increases.

# LDA

## Methodology

We used linear discriminant analysis on the standardised and outlier removed data including all variables. We wanted to see if we would be able to predict whether someone would have a high chance of finding a match on the dating application, Lovoo. We also grouped the observations into whether they had a normal chance of a match or a very low chance, giving us three chance groups total. We used the count of kisses (likes) as the indicator for the groups; higher than the third quantile (0.4) is classed as highly likely, and lower than the first quantile (0.23) is classed as unlikely. There is an uneven proportion seen between the three classes as seen in the lower right of the group-coloured pairs plot (figure \@ref(fig:LDApairs)). We used the count of kisses as our group indication as we believe that the more likes you get on your profile can equate to more matches, therefore giving the profile user a higher chance of a successful dating app outcome (i.e., a relationship). After creating these groups, we removed the count of kisses from our analysis and classification attempt.

Looking at the pairs plot again (figure \@ref(fig:LDApairs)) we can that there is some separation between groups that we can see visually (especially the highly likely class breaking away from the rest in the count of visits) but not much. In the univariate plots we can see that the data is not all normally distributed even after standardisation. Please note that country has been reduced to three levels instead of five for easy visualisation and analysis.

## Results

When conducting the linear discriminant analysis, we used the total five measures. We split into test and train sets randomly with a split of 80/20. From the group means output in table \@ref(LDAmeans), we can see that photo count and visits count have the highest influence on our predetermined groups, this confirms what we discovered about visits being correlated with kisses and therefore our dating chance groups. There is also a difference seen in Switzerland, with that country showing that it has a higher influence on the unlikely dating chance group compared to the other two factors.

The scaling coefficients in table \@ref(LDAcoef) show that the first linear discriminant is largely explained by the feature count of visits (as expected). The proportion of trace (between-class variance) of the first linear discriminant is 94% and the second is 6%. This informs the separability of the training data into the three classes by each linear discriminant.

When applying our analysis results using the predict function, we can plot the predicted score histograms. There was complete overlap in histograms between all groups in LD1 and LD2 meaning that neither of the discriminates could separate each group from each other, which is a bad outcome for our classification goal. Presented in figure \@ref(fig:LDAhist) is the predicted score histogram of LD1. There is complete overlap of all the groups in the biplot presented in figure \@ref(fig:LDAbiplot). From this we have gone back and tested a reduced the number of measures in the analysis to just count of photos, visits, and country. The results were similar so we continued to investigate the full model. Once again, we can see the large affect of visits on the model from the magnitude of the vector showing more discrimination between groups.

## Conclusion

When analysing the predicted vs observed classification table (table \@ref(RCM)) using the test data we set aside earlier we can see that the reported accuracy using LDA as a classification technique is 56% (with the biased optimistic accuracy on the training set matching this score). The classifier over classifies the dating app users as being in the normal chance group, meaning that there might not be any predictors included in the model that can be defined as outstanding dating profile features worthy of more matches.

This poor result maybe be due to the data failing the Box's M-test for Homogeneity of Covariance Matrices with a p-value of $2.2x10^{-16}$ and the classes being imbalanced. From these results, we applied quadratic discriminant analysis as this technique works better for data that fails the Box' M test. We did not see an improvement in classification accuracy with QDA achieving the same score of 56% on the test set. The results can be seen in table \@ref(QDAtab).

```{r createData, echo=FALSE}
lovoo <- read.csv("lovoo_v3_users_api-results.csv")
lovoo <- data.frame(lovoo)

lovoo <- lovoo[, c("age", "counts_pictures", "counts_profileVisits", 
                   "counts_kisses", "distance", "country", "isVip")]
# Replacing the missing values in distance with the mean 207.23
lovoo$distance[is.na(lovoo$distance)] <- 207.23

lovoo_standard <- as.data.frame(scale(lovoo[2:5]))


colnames(lovoo_standard) <- c("standard_pics", "standard_visits", "standard_kisses",
                              "standard_distance")

z_scores <- as.data.frame(sapply(lovoo_standard[1:4], function(lovoo_standard) (abs(lovoo_standard-mean(lovoo_standard))/sd(lovoo_standard))))

z_scores$isVip <- lovoo$isVip
z_scores$country <- lovoo$country
z_scores$age <- lovoo$age

colnames(z_scores) <- c("standard_pics", "standard_visits", "standard_kisses",
                              "standard_distance", "isVip", "country", 'age')

no_outliers <- z_scores[!rowSums(z_scores[1:4]>3), ]

no_outliers["country"][no_outliers["country"] == 'CH'] <- 'Switzerland'
no_outliers["country"][no_outliers["country"] == 'DE'] <- 'Germany'

# Replacing variable names
no_outliers <- transform(no_outliers, 
                    country = {x <- as.character(country)
                          x[!x %in% c("Switzerland","Germany")] <- "other"
                          factor(x)})

no_outliers$country <- as.factor(no_outliers$country)
no_outliers$isVip <- as.factor(no_outliers$isVip)

q1<-quantile(no_outliers$standard_kisses, probs = c(0.25))
q3<-quantile(no_outliers$standard_kisses, probs = c(0.75))

binned <- no_outliers %>% mutate(Group =
                                   case_when(standard_kisses <= q1 ~ "Unlikely", 
                                             standard_kisses < q3 ~ "Normal",
                                             standard_kisses >= q3 ~ "Highly_likely")
)

binned$Group<-as.factor(binned$Group)

binned = subset(binned, select = -c(standard_kisses))
```

```{r LDApairs, message=FALSE, echo=FALSE, fig.cap="Chance group-coloured pairs plot for LDA"}
ggpairs(binned, aes(alpha=.5, color=Group)) +
  theme_pander() +
  theme(text=element_text(family="serif"))
```

```{r LDAmodelOutput, echo=FALSE}
set.seed(300521444, kind="Mersenne-Twister")

ind <- sample(c("Tr", "Te"),
nrow(binned),
replace=TRUE,
prob=c(.8, .2))

# Explicitly split the data in "Train" and "Test"
Train <- binned[ind=="Tr",]
Test <- binned[ind=="Te",]
LDA <- lda(Group ~ .,
data=Train)
```

```{r ldat4, results = 'asis', echo=FALSE, message=FALSE, warning=FALSE}
LDAmeans<-LDA$means

row.names(LDAmeans) = str_wrap(row.names(LDAmeans), width=50)

print(xtable(LDAmeans, caption='Group means of Linear discriminate analysis', label='LDAmeans', align=c('p{1in}',rep('|c', ncol(LDAmeans)))),scalebox = 0.75, caption.placement="top", type="latex", comment=FALSE)

#print(xtable(LDAmeans, caption="Group means of Linear discriminate analysis", 
#             label="LDAmeans"), comment=FALSE, 
#            caption.placement="top", type="latex")
```

```{r ldat3, results = 'asis', echo=FALSE}
LDAcoef<-LDA$scaling
print(xtable(LDAcoef, caption="Scaling coeficients of Linear discriminate analysis", 
             label="LDAcoef"), comment=FALSE,
            caption.placement="top", type="latex")
```

```{r LDAhist, echo=FALSE, fig.cap="Predicted score histograms for LD1"}
Pred <- predict(LDA)
ldahist(data=Pred$x[,1], g=Train$Group)
```

```{r LDAbiplot, echo=FALSE, fig.cap="Linear discriminant biplot"}
ggord(LDA, Train$Group)
```

```{r ldat1, results = 'asis', echo=FALSE}
RealisticPredicted <- predict(LDA, Test)$class
RCM <- table(RealisticPredicted, Actual=Test$Group)

print(xtable(RCM, caption="Realistic predicted LDA classification", 
             label="RCM"), comment=FALSE,
            caption.placement="top", type="latex")
```

```{r ldat2, results = 'asis', echo=FALSE}
qda <- qda(Group~., data = Train)
qda.predict <- caret::train(Group~., method = "qda", data = Train)
cm<-confusionMatrix(Test$Group, predict(qda.predict, Test))
QDAtab <- as.table(cm)

print(xtable(QDAtab, caption="Realistic predicted QDA classification", 
             label="QDAtab"), comment=FALSE,
            caption.placement="top", type="latex")
```

# References

